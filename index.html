<!-- ===== index.html (Full Production Version) ===== -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>YiDimension 控制台</title>
  <script src="yidimension-sdk.js?v=20260216a"></script>
</head>
<body>
  <h2>YiDimension 调试台</h2>

  <div>
    UID: <input id="uid" />
    Token: <input id="token" />
    <button onclick="login()">登录</button>
  </div>

  <div>
    指令ID:
    <select id="cmdSelect" onchange="onCommandChange()">
      <option value="hurt">hurt（示例）</option>
      <option value="hurt_1">hurt_1（你当前测试值）</option>
      <option value="_stop_all">_stop_all（全局停止）</option>
      <option value="__custom__">自定义输入…</option>
    </select>
    <input id="customCmd" type="text" placeholder="仅当选择“自定义输入”时生效，如 player_hurt" style="display:none;" />
    <button onclick="send()">发送信号</button>
  </div>

  <div>
    当前将发送ID: <code id="previewCmd">hurt</code>
  </div>

  <div>
    连接状态: <span id="wsStatus">-</span>
    IM状态: <span id="imStatus">-</span>
  </div>

  <div>
    <h4>日志:</h4>
    <pre id="logBox"></pre>
  </div>

  <script>
    YiDimension.onLog = (level, msg) => {
      const box = document.getElementById('logBox');
      box.textContent += `[${level}] ${msg}\n`;
    };

    YiDimension.onStatusChange = (ws, im) => {
      document.getElementById('wsStatus').textContent = ws ? '已连接' : '未连接';
      document.getElementById('imStatus').textContent = im ? '已登录' : '未登录';
    };

    function login() {
      const uid = document.getElementById('uid').value;
      const token = document.getElementById('token').value;
      YiDimension.login(uid, token);
    }

    function onCommandChange() {
      const select = document.getElementById('cmdSelect');
      const customInput = document.getElementById('customCmd');
      const preview = document.getElementById('previewCmd');

      if (select.value === '__custom__') {
        customInput.style.display = 'inline-block';
        preview.textContent = customInput.value.trim() || '(等待输入)';
      } else {
        customInput.style.display = 'none';
        preview.textContent = select.value;
      }
    }

    function send() {
      const selectVal = document.getElementById('cmdSelect').value;
      const customVal = document.getElementById('customCmd').value.trim();
      const commandId = selectVal === '__custom__' ? customVal : selectVal;

      if (!commandId) {
        YiDimension.onLog && YiDimension.onLog('warn', '请选择或输入有效的指令ID');
        return;
      }

      document.getElementById('previewCmd').textContent = commandId;
      YiDimension.send(commandId);
    }

    document.getElementById('customCmd').addEventListener('input', () => {
      const select = document.getElementById('cmdSelect');
      if (select.value === '__custom__') {
        document.getElementById('previewCmd').textContent = document.getElementById('customCmd').value.trim() || '(等待输入)';
      }
    });

    onCommandChange();
    YiDimension.connect();
  </script>
</body>
</html>
