<!-- ===== index.html (IM 调试最简版) ===== -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>YiDimension 控制台</title>
  <script src="yidimension-sdk.js?v=20260218c"></script>
</head>
<body>
  <h2>YiDimension IM 调试台（game_cmd 固定版）</h2>

  <div>
    UID: <input id="uid" />
    Token: <input id="token" />
    <button onclick="login()">登录</button>
  </div>

  <div style="margin-top: 10px;">
    指令ID:
    <input id="commandId" type="text" placeholder="请输入开发游戏中的指令ID，如 hurt / hurt_1 / _stop_all" />
    <button onclick="send()">发送信号</button>
  </div>

  <div style="margin-top: 10px;">
    当前将发送: <code id="previewPayload">{"code":"game_cmd","id":"","token":"(空)"}</code>
  </div>

  <div>
    连接状态: <span id="wsStatus">-</span>
    IM状态: <span id="imStatus">-</span>
  </div>

  <div>
    <h4>日志:</h4>
    <pre id="logBox"></pre>
  </div>

  <script>
    YiDimension.onLog = (level, msg) => {
      const box = document.getElementById('logBox');
      box.textContent += `[${level}] ${msg}\n`;
    };

    YiDimension.onStatusChange = (ws, im) => {
      document.getElementById('wsStatus').textContent = ws ? '已连接' : '未连接';
      document.getElementById('imStatus').textContent = im ? '已登录' : '未登录';
    };

    function refreshPreview() {
      const id = (document.getElementById('commandId').value || '').trim();
      const token = (document.getElementById('token').value || '').trim();
      const tokenMask = token ? '***' : '(空)';
      const preview = { code: 'game_cmd', id, token: tokenMask };
      document.getElementById('previewPayload').textContent = JSON.stringify(preview);
    }

    function login() {
      const uid = document.getElementById('uid').value;
      const token = document.getElementById('token').value;
      YiDimension.login(uid, token);
      refreshPreview();
    }

    function send() {
      const commandId = (document.getElementById('commandId').value || '').trim();
      if (!commandId) {
        YiDimension.onLog && YiDimension.onLog('warn', '请输入有效的指令ID');
        return;
      }
      YiDimension.send(commandId);
      refreshPreview();
    }

    document.getElementById('commandId').addEventListener('input', refreshPreview);
    document.getElementById('token').addEventListener('input', refreshPreview);

    refreshPreview();
    YiDimension.connect();
  </script>
</body>
</html>
